<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Estatísticas</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="registerResult()">
        <ion-icon name="add"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Estatísticas</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Segment para alternar entre Time e Jogadores -->
  <ion-segment 
    [(ngModel)]="selectedSegment" 
    (ionChange)="segmentChanged($event)"
    class="stats-segment">
    <ion-segment-button value="team">
      <ion-label>Time</ion-label>
    </ion-segment-button>
    <ion-segment-button value="players">
      <ion-label>Jogadores</ion-label>
    </ion-segment-button>
  </ion-segment>

  <!-- Estatísticas do Time -->
  <div *ngIf="selectedSegment === 'team'" class="team-stats">
    <ion-card class="overview-card">
      <ion-card-header>
        <ion-card-title>Visão Geral do Time</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="stats-overview">
          <div class="stat-item">
            <div class="stat-value">{{ teamStats?.totalMatches || 0 }}</div>
            <div class="stat-label">Total de Partidas</div>
          </div>
          <div class="stat-item">
            <div class="stat-value success">{{ teamStats?.victories || 0 }}</div>
            <div class="stat-label">Vitórias</div>
          </div>
          <div class="stat-item">
            <div class="stat-value warning">{{ teamStats?.draws || 0 }}</div>
            <div class="stat-label">Empates</div>
          </div>
          <div class="stat-item">
            <div class="stat-value danger">{{ teamStats?.defeats || 0 }}</div>
            <div class="stat-label">Derrotas</div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <ion-card class="performance-card">
      <ion-card-header>
        <ion-card-title>Aproveitamento do Time</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="performance-display">
          <div class="chart-container">
            <div class="circular-progress">
              <svg class="progress-ring" width="120" height="120">
                <circle
                  class="progress-ring-circle-bg"
                  stroke="#e9ecef"
                  stroke-width="8"
                  fill="transparent"
                  r="52"
                  cx="60"
                  cy="60"
                />
                <circle
                  class="progress-ring-circle"
                  stroke="url(#gradient)"
                  stroke-width="8"
                  fill="transparent"
                  r="52"
                  cx="60"
                  cy="60"
                  [style.stroke-dasharray]="(2 * Math.PI * 52)"
                  [style.stroke-dashoffset]="(2 * Math.PI * 52) - ((teamStats?.winRate || 0) / 100) * (2 * Math.PI * 52)"
                />
                <defs>
                  <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#007bff;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#0056b3;stop-opacity:1" />
                  </linearGradient>
                </defs>
              </svg>
              <div class="progress-content">
                <div class="progress-value">{{ teamStats?.winRate || 0 }}%</div>
                <div class="progress-label">APROVEITAMENTO</div>
              </div>
            </div>
          </div>
          
          <div class="stats-breakdown">
            <div class="stat-row">
              <div class="stat-dot success"></div>
              <div class="stat-info">
                <span class="stat-label">Vitórias</span>
                <span class="stat-value">{{ teamStats?.victories || 0 }}</span>
              </div>
            </div>
            <div class="stat-row">
              <div class="stat-dot warning"></div>
              <div class="stat-info">
                <span class="stat-label">Empates</span>
                <span class="stat-value">{{ teamStats?.draws || 0 }}</span>
              </div>
            </div>
            <div class="stat-row">
              <div class="stat-dot danger"></div>
              <div class="stat-info">
                <span class="stat-label">Derrotas</span>
                <span class="stat-value">{{ teamStats?.defeats || 0 }}</span>
              </div>
            </div>
            <div class="stat-row">
              <div class="stat-dot medium"></div>
              <div class="stat-info">
                <span class="stat-label">W.O</span>
                <span class="stat-value">{{ teamStats?.walkOvers || 0 }}</span>
              </div>
            </div>
            <div class="total-matches">
              <span class="total-label">Total de Partidas</span>
              <span class="total-value">{{ teamStats?.totalMatches || 0 }}</span>
            </div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Estatísticas dos Jogadores -->
  <div *ngIf="selectedSegment === 'players'" class="players-stats">
    <ion-card class="ranking-card">
      <ion-card-header>
        <ion-card-title>Ranking de Jogadores</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item 
            *ngFor="let player of players; let i = index" 
            button 
            (click)="viewPlayerDetails(player)"
            class="player-ranking-item">
            <div slot="start" class="ranking-position">
              <span class="position-number">{{ i + 1 }}</span>
            </div>
            <ion-avatar>
              <ion-icon name="person" size="large"></ion-icon>
            </ion-avatar>
            <ion-label>
              <h2>{{ player.name }}</h2>
              <p>{{ getPositionLabel(player.position) }} • #{{ player.number || 'N/A' }}</p>
              <p class="player-stats">
                {{ player.stats.victories }}V • 
                {{ player.stats.draws }}E • 
                {{ player.stats.defeats }}D
              </p>
            </ion-label>
            <div slot="end" class="player-performance">
              <ion-badge [color]="getBadgeColor(player.stats.winRate)">
                {{ player.stats.winRate }}%
              </ion-badge>
              <p class="matches-count">{{ player.stats.totalMatches }} jogos</p>
            </div>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Botão para registrar resultado -->
  <div class="action-section">
    <ion-button 
      expand="block" 
      (click)="registerResult()"
      class="register-button">
      <ion-icon name="add" slot="start"></ion-icon>
      Registrar Resultado
    </ion-button>
  </div>
</ion-content>

